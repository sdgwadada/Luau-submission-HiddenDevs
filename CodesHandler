local replicatedStorage = game:GetService("ReplicatedStorage")
local userInputService = game:GetService("UserInputService")

local events = replicatedStorage:WaitForChild("Events")
local resetCodesEvent = events:WaitForChild("resetCodes")
local functions = replicatedStorage:WaitForChild("Functions")
local redeemEvent = functions:WaitForChild("redeemCode")

local toggleButton = script.Parent.codes
local codesFrame = script.Parent.codesFrame
local redeemButton = codesFrame.redeemButton
local enterCodes = codesFrame.enterCodes
local errorTitle = codesFrame.errorTitle

local db = false

enterCodes.Text = "Enter a code!"

local function toggle()
	codesFrame.Visible = not codesFrame.Visible
end

local function showMessage(message, tokens)
	if message == "Code redeemed successfully!" then
		errorTitle.Text = message .. " +" .. tokens .. " mutantTokens!"
		errorTitle.TextColor3 = Color3.fromRGB(0,255,0)
		errorTitle.UIStroke.Color = Color3.fromRGB(0, 75, 0)
		errorTitle.Visible = true
		warn(message)
		
		task.wait(1.5) -- wait 1.5 seconds before restoring everything back to original state
		
		errorTitle.Visible = false
		errorTitle.TextColor3 = Color3.fromRGB(255,0,0)
		errorTitle.UIStroke.Color = Color3.fromRGB(161, 0, 0)
		enterCodes.Text = "Enter a code!"
	else
		errorTitle.Text = message
		errorTitle.Visible = true
		warn(message)
		task.wait(1.5)
		errorTitle.Visible = false
		enterCodes.Text = "Enter a code!"
	end
end

redeemButton.MouseButton1Click:Connect(function()
	if db == true then return end
	db = true
	redeemButton.AutoButtonColor = false
	redeemButton.Active = false

	local success, message, money = nil, nil, nil

	local code = enterCodes.Text:lower():gsub("^%s*(.-)%s*$", "%1")
	if not code or code == "" or code:match("^%s*$") then
		db = false
		errorTitle.Text = "Please enter a code!"
		errorTitle.Visible = true
		task.wait(2)
		errorTitle.Visible = false
		warn("Please enter a code!")
	else
		success, message, money = redeemEvent:InvokeServer(code)
		if success then
			
			showMessage(message, money)
			task.wait(2)
			errorTitle.Text = ""
			enterCodes.Text = "Enter a code!"
		else
			showMessage(message)
		end
	end

	redeemButton.AutoButtonColor = true
	redeemButton.Active = true
	db = false
end)

toggleButton.Activated:Connect(function()
	toggle()
end)

userInputService.InputBegan:Connect(function(input,processed)
	if not processed and input.KeyCode == Enum.KeyCode.T then
		resetCodesEvent:FireServer()
	end
end)

while true do
	if userInputService:GetFocusedTextBox() ~= enterCodes and enterCodes.Text == "" then
		task.wait()
		if enterCodes.Text ~= "" then return end
		enterCodes.Text = "Enter a code!"
	end
	task.wait(1) --this can be revamped but rn i have no time to do that
end

--pretty easy, did not take much time to script
